<!-- 
Momoka Michimoto
This page creates foundation of my order page.
Code referenced from assignment 1 examples.
-->

<script src="/products.js" type="text/javascript"></script>
<script src="./functions.js"></script>
<script>
    
    function isNonNegInt(q, return_errors = false) {
        errors = []; // assume no errors at first
        if (q == '') q = 0; // handle blank inputs as if they are 0
        if (Number(q) != q) errors.push('<font color="red">Not a number!</font>'); // Check if string is a number value
        else if (q < 0) errors.push('<font color="red">Negative value!</font>'); // Check if it is non-negative
        else if (parseInt(q) != q) errors.push('<font color="red">Not an integer!</font>'); // Check that it is an integer
        return return_errors ? errors : (errors.length == 0);
    }

    function checkQuantityTextbox(theTextbox) {
        errs = isNonNegInt(theTextbox.value, true);
        document.getElementById(theTextbox.name + '_errordiv').innerHTML = errs.join(", ");
    }

    let params = (new URL(document.location)).searchParams; // get the query string which has the form data

    window.onload = function () {

        // form was submitted so check that quantities are valid then redirect to invoice if ok.
        if (params.has('errors')) {
            var errors = JSON.parse(params.get('errors')); //turns string in object
            let err_str = '';
            for (err in errors) { //combine errors in one string
                err_str += errors[err] + '\n';
            }
            alert(err_str);
        }

        if (params.has('quantity')) {
            var quantities = JSON.parse(params.get('quantity')); //turns string in object
            // put quantities in quantity textboxes
            for (i in quantities) {
                order_form['quantity[' + i + ']'].value = quantities[i];
                checkQuantityTextbox(order_form['quantity[' + i + ']']);
            }
        }
    }
</script>

<script>
    // Do i have products_key?
    if (params.has('products_key')) {
        var products_key = params.get('products_key');
    } else {
        var products_key = "plates";
    }

</script>


<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="products-style.css">
    <!-- <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"> -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Zen+Antique+Soft&display=swap">
    <title>Fresh JStore</title>
</head>

<body>


    <!-- Navbar (sit on top) -->
    <header class="page-header wrapper">
        <nav>
            <ul class="main-nav" style="background-color:#fff">
                <li><a href="./index.html">HOME</a></li>
                <li><a href="./products_display.html">Seafoods</a></li>
                <li><a href="./products_a.html">Alcohol</a></li>
                <li><a href="./products_s.html">Sweets</a></li>
                <li><a href="./products_p.html">Plates</a></li>
                <li><a href="#about">ABOUT</a></li>
                <li><a href="#contact">CONTACT</a></li>
            </ul>
        </nav>
    </header>
    <div class="home-content wrapper">
        <h2 class="page-title" style="background-color:#fff">Fresh JStore</h2>

    </div>
    </header>

    <!-- Menu Container -->

    <body>

        <form name="order_form" action="./process_form" method="POST">
            <!-- the server is going to post the form to process_form -->
            <div>
                <main>
                    <script>
                        //get products name, price, and image through loop
                        //make this in loop not to make the code complexed
                        for (i in products[products_key]) {
                            document.write(`
                    <section class="item">
                    <ul>
                    <h2><b>${products[products_key][i].name}</b></h2>
                    <div class="img_wrap">
                    <img src="./images/${products[products_key][i].image}"></div>
                    <p>$${products[products_key][i].price}</p>
                    <input type="text" placeholder="${products[products_key][i].quantity_available} Available" name="quantity[${i}]" onkeyup="checkQuantityTextbox(this);">
                    <div id="quantity[${i}]_errordiv"></div>
                    </ul>
                    </section>
                    `);
                        }
                    </script>
                </main>
            </div>

            <!-- purchase button -->
            <input type="submit" class="button" value="PURCHASE">


        </form>

        <!-- About Container -->
        <div id="about">
            <h1 style="color:rgb(250, 143, 161); font-size: 40px;background-color:#fff">About</h1>
            <h2>
                <p>Fresh JSeafood store is a online market. We carry select seafood. Many people love ordering our
                    product to enjoy Japanese products at the home. Check out the Japanese products directly from Japan to
                    you door and cook like a chef at home.</p>
            </h2>
        </div>

        <!-- Footer -->
        <div id="contact">
            <footer>
                <p>
                    Author: Momoka Michimoto
                    <br>
                    <a href="mailto:ms295@hawaii.edu">ms295@hawaii.edu</a>
                </p>
            </footer>
        </div>

    </body>

</html>