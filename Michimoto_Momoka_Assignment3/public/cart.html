<!-- 
    Author: Momoka Michimoto
    
    Referenced code from Assignment 3 examples
-->


<!DOCTYPE html>
<html lang="en">

  <script src="./products.js" type="text/javascript"></script>
  <script src="./functions.js"></script>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="invoice-style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat&family=Playfair+Display&display=swap"
    rel="stylesheet">
  <style>
    body {
      transform: scale(1);
      transform-origin: 0 0;
    }
  </style>
  <script>
    var products_data;
    var total = 0;
    loadJSON('get_products', function (response) {
        // Parsing JSON string into object
        products = JSON.parse(response);
    });
    loadJSON('get_cart', function (response) {
        // Parsing JSON string into object
        shopping_cart = JSON.parse(response);
        for (pk in shopping_cart) {
        total += shopping_cart[pk].reduce((a, b) => a + b);
    }
  });

  // get the query string --> there is no query string so I need to fix this
  let params = (new URL(document.location)).searchParams;
  if (params.has('products_key')) {
    var this_product_key = params.get('products_key');
  } else {
    // document.write('no products key in query string');
    document.stop;
  }

  // // navigation bar
  // document.write(`<a href='./index.html'>Home</a>&nbsp&nbsp&nbsp;`);
  // nav_bar(this_product_key, products_data);

  // get the particular products to display
  products = products_data[products_key]; 
 

</script>
</head>


<!-- used template from bootdey.com  -->

<body>
    <form class="register" action="./register" method="POST">
   <table class="body-wrap">
     <tbody>
       <tr>
         <td></td>
         <td class="container" width="600">
           <div class="content">
             <table class="main" width="100%" cellpadding="0" cellspacing="0">
               <tbody>
                 <tr>
                   <td class="content-wrap aligncenter">
                     <table width="100%" cellpadding="0" cellspacing="0">
                       <tbody>
                         <tr>
                           <td class="content-block">
                             <h2>You have:</h2>
                           </td>
                         </tr>
 
                         <td class="content-block">
                           <table class="invoice" border="1" align="center">
                             <tbody>
                               <tr>
                                 <th style="text-align: center;" width="43%">Item</th>
                                 <th style="text-align: center;" width="11%">Price</th>
                                 <th style="text-align: center;" width="11%">quantity</th>
                                 
                                 
                               
                               <script>
                                for(products_key in products) {
                                  for(i=0; i<products[products_key].length; i++) {
                                      if(typeof shopping_cart[products_key] == 'undefined') continue;
                                      qty = shopping_cart[products_key][i];
                                      if(qty > 0) {
                                        document.write(`<tr><td>${qty}</td><td>${products[products_key][i].name}</td><tr>`);
                              
                                      }
                                  }
                              }
                              
                            </script>
                            </tr>
                               <!-- <tr>
                                 <td colspan="4" width="100%">&nbsp;</td>
                               </tr>
                                -->
                           
                       </tbody>
                     </table>
                   
                    <form action="/confirm" method=GET>
                    <input type="submit" class="button" value="Check Out"></form>

                      <!-- navigation var to the home page -->
                    <script>
                        document.write(`<div class="Keep shopping" style="color:black"><a href="index.html${location.search}"><br>Continue Shopping?</a></div>`)
                    </script>
                    

</body>

</html>