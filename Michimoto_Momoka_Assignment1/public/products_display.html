<!-- Referenced from assignment 1 examples -->
<script src="./products.js" type="text/javascript"></script>
<script>
    function isNonNegInt(q, return_errors = false) {
        errors = []; // assume no errors at first
        if (q == '') q = 0; // handle blank inputs as if they are 0
        if (Number(q) != q) errors.push('<font color="red">Not a number!</font>'); // Check if string is a number value
        else if (q < 0) errors.push('<font color="red">Negative value!</font>'); // Check if it is non-negative
        else if (parseInt(q) != q) errors.push('<font color="red">Not an integer!</font>'); // Check that it is an integer
        return return_errors ? errors : (errors.length == 0);
    }

    function checkQuantityTextbox(theTextbox) {
        errs = isNonNegInt(theTextbox.value, true);
        if (errs.length == 0) errs = ['You want:'];
        if (theTextbox.value.trim() == '') errs = ['Quantity'];
        document.getElementById(theTextbox.name + '_label').innerHTML = errs.join(", ");
    }

    window.onload = function () {
        let params = (new URL(document.location)).searchParams; // get the query string which has the form data
        // form was submitted so check that quantities are valid then redirect to invoice if ok.
        if (params.has('purchase_submit')) {
            has_errors = false; // assume quantities are valid from the start
            total_qty = 0; // need to check if something was selected so we will look if the total > 0
            for (i = 0; i < products.length; i++) {
                if (params.has(`quantity${i}`)) {
                    a_qty = params.get(`quantity${i}`);
                    // make textboxes sticky in case of invalid data
                    product_selection_form[`quantity${i}`].value = a_qty;
                    total_qty += a_qty;
                    if (!isNonNegInt(a_qty)) {
                        has_errors = true; // oops, invalid quantity
                        checkQuantityTextbox(product_selection_form[`quantity${i}`]); // show where the error is
                    }
                }
            }
            // Now respond to errors or redirect to invoice if all is ok
            if (has_errors) {
                alert("Please enter only valid quantities");
            } else if (total_qty == 0) { // no quantity selections, just give a general alert
                alert("Please select some quantities");
            } else { // all good to go!
                window.location = `./invoice.html${document.location.search}`;
                window.stop;
            }
        }
    }
</script>

<!-- Uses W3 Pizza Restaurant Template -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <base href="/"> -->
    <link rel="stylesheet" href="products-style.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Zen+Antique+Soft&display=swap">
    <title>Fresh JSeafood Stored</title>
</head>

<body>
    <script>
       document.write(`<h3>${products[0]["brand"]} at \$${products[0]["price"]}</h3>`);
    </script>

    <!-- Navbar (sit on top) -->
    <div class="w3-top w3-hide-small">
        <div class="w3-bar w3-xlarge w3-black w3-opacity w3-hover-opacity-off" id="myNavbar">
            <a href="#" class="w3-bar-item w3-button">HOME</a>
            <a href="#menu" class="w3-bar-item w3-button">MENU</a>
            <a href="#about" class="w3-bar-item w3-button">ABOUT</a>
            <a href="#contact" class="w3-bar-item w3-button">CONTACT</a>
        </div>
    </div>

    <!-- Header with image -->
    <header class="bgimg w3-display-container w3-grayscale-min" id="home">
        <div class="w3-display-middle w3-center">
            <span class="w3-text-white w3-hide-small" style="font-size:100px">Fresh<br>Japanese Seafood</span>
            <span class="w3-text-white w3-hide-large w3-hide-medium" style="font-size:60px"><b>fresh<br>Japanese
                    Seafood</b></span>
            <p><a href="#menu" class="w3-button w3-xxlarge w3-white">Let me see the menu</a></p>
        </div>
    </header>

    <!-- Menu Container -->

    <body>
        <h1 id='menu'>

            <br>
            <h1 class="w3-center w3-jumbo" style="margin-bottom:64px">Fresh JSeafood Store</h1>
            <form action="./process_form" 
            method="POST">
                <!-- the server is going to post the form to process_form -->
                <div>
                    <main>
                        <script>
                            //get products name, price, and image through loop
                            //make this in loop not to make the code complexed
                            for (i = 0; i < products.length; i++) {
                                document.write(`
                <section class="item">
                    <h2><span class="w3-center w3-tag w3-dark-grey w3-round"><b>${products[i].name}</b></h2>
                
                    <p><span class="w3-left w3-tag w3-dark-grey w3-round">$${products[i].price}</span></p>
                    
                    <input type="number" value=0 name="quantity${i}">
                    
                    <div class="img_wrap">
                    <img src="./images/${products[i].image}"></div>
                </section>
                    `);
                            }
                        </script>
                    </main>
                </div>

                <!-- purchase button -->
                <input type="submit" value="PURCHASE">

                
            </form>

            <!-- About Container -->
            <div class="w3-container w3-padding-64 w3-red w3-grayscale w3-xlarge" id="about">
                <div class="w3-content">
                    <h1 class="w3-center w3-jumbo" style="margin-bottom:64px">About</h1>
                    <p>Fresh JSeafood store is a online market. We carry select seafood. Many people love ordering our
                        product to enjoy fresh seafood at the home. Check out the fresh seafood flown directly from
                        Japan to you door and cook like a chef at home.</p>

                    <!-- Contact -->
                    <div class="w3-container w3-padding-64 w3-blue-grey w3-grayscale-min w3-xlarge" id="contact">
                        <div class="w3-content">
                            <h1 class="w3-center w3-jumbo" style="margin-bottom:64px">Contact</h1>
                            <p>Find us across the street from Don Quijote Honolulu or call us at 808-732-3663</p>
                            <p><span class="w3-tag">FYI!</span>In addition, to what's available online. We also offer
                                full-service catering for any event, large or small.
                                We understand your needs and we will cater the food to satisfy the biggest criteria of
                                them all - presentation and taste.
                            </p>
                            <form action="/action_page.php" target="_blank">
                                <p><input class="w3-input w3-padding-16 w3-border" type="text" placeholder="Name"
                                        required name="Name"></p>
                                <p><input class="w3-input w3-padding-16 w3-border" for="email"
                                        placeholder="john@example.com" required name="email"></p>
                                <p><input class="w3-input w3-padding-16 w3-border" type="text"
                                        placeholder="Message \ Special requirements" required name="Message"></p>
                                <p><button class="w3-button w3-light-grey w3-block" type="submit">SEND US
                                        MESSAGE</button></p>
                            </form>
                        </div>
                    </div>

                    <!-- Footer -->
                    <footer class="w3-center w3-black w3-padding-48 w3-xxlarge">
                        <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS"
                                target="_blank" class="w3-hover-text-green">w3.css</a></p>
                    </footer>

                    <script>
                        // Tabbed Menu
                        function openMenu(evt, menuName) {
                            var i, x, tablinks;
                            x = document.getElementsByClassName("menu");
                            for (i = 0; i < x.length; i++) {
                                x[i].style.display = "none";
                            }
                            tablinks = document.getElementsByClassName("tablink");
                            for (i = 0; i < x.length; i++) {
                                tablinks[i].className = tablinks[i].className.replace(" w3-red", "");
                            }
                            document.getElementById(menuName).style.display = "block";
                            evt.currentTarget.firstElementChild.className += " w3-red";
                        }
                        // document.getElementById("myLink").click();
                    </script>

    </body>

</html>